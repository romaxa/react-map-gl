{"version":3,"sources":["../../../src/components/base-control.js"],"names":["PureComponent","createElement","createRef","PropTypes","InteractiveContext","StaticContext","propTypes","captureScroll","bool","captureDrag","captureClick","captureDoubleClick","defaultProps","BaseControl","props","evt","stopPropagation","eventManager","_context","manager","get","enable","options","_toggleRecognizer","setTimeout","_events","_containerRef","ref","current","wheel","_onScroll","panstart","_onDragStart","click","_onClick","pointerup","_onPointerUp","on","off","Error","Consumer","interactiveContext","staticContext","Object","assign","_render"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {PureComponent, createElement, createRef} from 'react';\nimport PropTypes from 'prop-types';\nimport {InteractiveContext} from './interactive-map';\nimport {StaticContext} from './static-map';\n\nconst propTypes = {\n  /** Event handling */\n  captureScroll: PropTypes.bool,\n  // Stop map pan & rotate\n  captureDrag: PropTypes.bool,\n  // Stop map click\n  captureClick: PropTypes.bool,\n  // Stop map double click\n  captureDoubleClick: PropTypes.bool\n};\n\nconst defaultProps = {\n  captureScroll: false,\n  captureDrag: true,\n  captureClick: true,\n  captureDoubleClick: true\n};\n\n/*\n * PureComponent doesn't update when context changes.\n * The only way is to implement our own shouldComponentUpdate here. Considering\n * the parent component (StaticMap or InteractiveMap) is pure, and map re-render\n * is almost always triggered by a viewport change, we almost definitely need to\n * recalculate the marker's position when the parent re-renders.\n */\nexport default class BaseControl extends PureComponent {\n\n  constructor(props) {\n    super(props);\n\n    this._context = {};\n    this._events = null;\n    this._containerRef = createRef();\n  }\n\n  componentDidMount() {\n    const ref = this._containerRef.current;\n    if (!ref) {\n      return;\n    }\n\n    const {eventManager} = this._context;\n\n    // Return early if no eventManager is found\n    if (eventManager) {\n      this._events = {\n        wheel: this._onScroll,\n        panstart: this._onDragStart,\n        click: this._onClick,\n        pointerup: this._onPointerUp\n      };\n      eventManager.on(this._events, ref);\n    }\n  }\n\n  componentWillUnmount() {\n    const {eventManager} = this._context;\n    if (eventManager && this._events) {\n      eventManager.off(this._events);\n    }\n  }\n\n  _onScroll = (evt) => {\n    if (this.props.captureScroll) {\n      evt.stopPropagation();\n    }\n  }\n\n  _onDragStart = (evt) => {\n    if (this.props.captureDrag) {\n      evt.stopPropagation();\n    }\n  }\n\n  _onPointerUp = (evt) => {\n    if (this.props.captureDoubleClick) {\n      const {eventManager} = this._context;\n      const {options: {enable}} = eventManager.manager.get('doubletap');\n      // Temporarily disable doubletap\n      if (enable) {\n        eventManager._toggleRecognizer('doubletap', false);\n        /* global setTimeout */\n        setTimeout(() => {\n          eventManager._toggleRecognizer('doubletap', true);\n        }, 0);\n      }\n    }\n  }\n\n  _onClick = (evt) => {\n    if (this.props.captureClick) {\n      evt.stopPropagation();\n    }\n  }\n\n  _render() {\n    throw new Error('_render() not implemented');\n  }\n\n  render() {\n    return (\n      createElement(InteractiveContext.Consumer, null,\n        (interactiveContext) => {\n          // Save event manager\n          return createElement(StaticContext.Consumer, null,\n            (staticContext) => {\n              this._context = Object.assign({}, interactiveContext, staticContext);\n              return this._render();\n            }\n          );\n        }\n      )\n    );\n  }\n}\n\nBaseControl.propTypes = propTypes;\nBaseControl.defaultProps = defaultProps;\n"],"file":"base-control.js"}