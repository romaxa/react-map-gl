{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["PureComponent","createElement","createContext","createRef","PropTypes","StaticMap","MAPBOX_LIMITS","WebMercatorViewport","TransitionManager","EventManager","MapController","config","deprecateWarn","InteractiveContext","eventManager","isDragging","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","onInteractionStateChange","transitionDuration","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onDblClick","onContextMenu","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onMouseEnter","onMouseLeave","onMouseOut","onWheel","touchAction","string","clickRadius","interactiveLayerIds","array","getCursor","controller","shape","events","arrayOf","handleEvent","getDefaultCursor","isHovering","CURSOR","GRABBING","POINTER","GRAB","defaultProps","event","preventDefault","InteractiveMap","supported","constructor","props","_staticMapRef","current","getMap","geometry","options","queryRenderedFeatures","interactionState","state","setState","width","height","_width","_height","_setControllerProps","onResize","viewState","oldViewState","callbackName","_normalizeEvent","pointerType","_onEvent","features","_getFeatures","pos","point","radius","length","isEntering","isExiting","_controller","_eventManager","legacyBlockScroll","_eventCanvasRef","componentDidMount","setElement","on","pointerdown","_onPointerDown","pointermove","_onPointerMove","pointerup","_onPointerUp","pointerleave","bind","click","_onClick","dblclick","wheel","contextmenu","componentWillUpdate","nextProps","isInteractive","Boolean","_onViewportChange","onStateChange","_onInteractionStateChange","setOptions","queryParams","layers","size","bbox","lngLat","offsetCenter","x","y","viewport","unproject","render","style","eventCanvasStyle","position","cursor","interactiveContext","Provider","value","key","ref","_onResize","children","displayName"],"mappings":"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","sourcesContent":["import {PureComponent, createElement, createContext, createRef} from 'react';\nimport PropTypes from 'prop-types';\n\nimport StaticMap from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport TransitionManager from '../utils/transition-manager';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport config from '../config';\nimport deprecateWarn from '../utils/deprecate-warn';\n\nexport const InteractiveContext = createContext({\n  eventManager: null,\n  isDragging: false\n});\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.number,\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.bool,\n  // Drag to pan\n  dragPan: PropTypes.bool,\n  // Drag to rotate\n  dragRotate: PropTypes.bool,\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.bool,\n  // Multitouch rotate\n  touchRotate: PropTypes.bool,\n  // Keyboard\n  keyboard: PropTypes.bool,\n\n  /** Event callbacks */\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** List of layers that are interactive */\n  interactiveLayerIds: PropTypes.array,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controller\n  // The object must expose one property: `events` as an array of subscribed\n  // event names; and two methods: `setState(state)` and `handle(event)`\n  controller: PropTypes.shape({\n    events: PropTypes.arrayOf(PropTypes.string),\n    handleEvent: PropTypes.func\n  })\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) => isDragging ?\n  config.CURSOR.GRABBING :\n  (isHovering ? config.CURSOR.POINTER : config.CURSOR.GRAB);\n\nconst defaultProps = Object.assign({},\n  StaticMap.defaultProps, MAPBOX_LIMITS, TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n\n    touchAction: 'none',\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\nexport default class InteractiveMap extends PureComponent {\n\n  static supported() {\n    return StaticMap.supported();\n  }\n\n  constructor(props) {\n    super(props);\n    // Check for deprecated props\n    deprecateWarn(props);\n\n    this.state = {\n      // Whether the cursor is down\n      isDragging: false,\n      // Whether the cursor is over a clickable feature\n      isHovering: false\n    };\n\n    // If props.controller is not provided, fallback to default MapController instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._controller = props.controller || new MapController();\n\n    this._eventManager = new EventManager(null, {\n      legacyBlockScroll: false,\n      touchAction: props.touchAction\n    });\n    this._width = 0;\n    this._height = 0;\n    this._eventCanvasRef = createRef();\n    this._staticMapRef = createRef();\n  }\n\n  componentDidMount() {\n    const eventManager = this._eventManager;\n\n    eventManager.setElement(this._eventCanvasRef.current);\n    // Register additional event handlers for click and hover\n    eventManager.on({\n      pointerdown: this._onPointerDown,\n      pointermove: this._onPointerMove,\n      pointerup: this._onPointerUp,\n      pointerleave: this._onEvent.bind(this, 'onMouseOut'),\n      click: this._onClick,\n      dblclick: this._onEvent.bind(this, 'onDblClick'),\n      wheel: this._onEvent.bind(this, 'onWheel'),\n      contextmenu: this._onEvent.bind(this, 'onContextMenu')\n    });\n\n    this._setControllerProps(this.props);\n  }\n\n  componentWillUpdate(nextProps) {\n    this._setControllerProps(nextProps);\n  }\n\n  getMap = () => {\n    return this._staticMapRef.current ? this._staticMapRef.current.getMap() : null;\n  }\n\n  queryRenderedFeatures = (geometry, options) => {\n    return this.getMap().queryRenderedFeatures(geometry, options);\n  }\n\n  _setControllerProps(props) {\n    props = Object.assign({}, props, props.viewState, {\n      isInteractive: Boolean(props.onViewStateChange || props.onViewportChange),\n      onViewportChange: this._onViewportChange,\n      onStateChange: this._onInteractionStateChange,\n      eventManager: this._eventManager,\n      width: this._width,\n      height: this._height\n    });\n\n    this._controller.setOptions(props);\n  }\n\n  _getFeatures({pos, radius}) {\n    let features;\n    const queryParams = {};\n\n    if (this.props.interactiveLayerIds) {\n      queryParams.layers = this.props.interactiveLayerIds;\n    }\n\n    if (radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      const size = radius;\n      const bbox = [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]];\n      features = this.getMap().queryRenderedFeatures(bbox, queryParams);\n    } else {\n      features = this.getMap().queryRenderedFeatures(pos, queryParams);\n    }\n    return features;\n  }\n\n  _onInteractionStateChange = (interactionState) => {\n    const {isDragging = false} = interactionState;\n    if (isDragging !== this.state.isDragging) {\n      this.setState({isDragging});\n    }\n\n    const {onInteractionStateChange} = this.props;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  }\n\n  _onResize = ({width, height}) => {\n    this._width = width;\n    this._height = height;\n    this._setControllerProps(this.props);\n    this.props.onResize({width, height});\n  }\n\n  _onViewportChange = (viewState, interactionState, oldViewState) => {\n    const {onViewStateChange, onViewportChange} = this.props;\n\n    if (onViewStateChange) {\n      onViewStateChange({viewState, interactionState, oldViewState});\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  }\n\n  /* Generic event handling */\n  _normalizeEvent(event) {\n    if (event.lngLat) {\n      // Already unprojected\n      return event;\n    }\n\n    const {offsetCenter: {x, y}} = event;\n    const pos = [x, y];\n\n    const viewport = new WebMercatorViewport(Object.assign({}, this.props, {\n      width: this._width,\n      height: this._height\n    }));\n\n    event.point = pos;\n    event.lngLat = viewport.unproject(pos);\n\n    return event;\n  }\n\n  _onEvent = (callbackName, event) => {\n    const func = this.props[callbackName];\n    if (func) {\n      func(this._normalizeEvent(event));\n    }\n  }\n\n  /* Special case event handling */\n  _onPointerDown = (event) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchStart', event);\n      break;\n\n    default:\n      this._onEvent('onMouseDown', event);\n    }\n  }\n\n  _onPointerUp = (event) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchEnd', event);\n      break;\n\n    default:\n      this._onEvent('onMouseUp', event);\n    }\n  }\n\n  _onPointerMove = (event) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchMove', event);\n      break;\n\n    default:\n      this._onEvent('onMouseMove', event);\n    }\n\n    if (!this.state.isDragging) {\n      const {onHover, interactiveLayerIds} = this.props;\n      let features;\n      if (interactiveLayerIds || onHover) {\n        event = this._normalizeEvent(event);\n        features = this._getFeatures({pos: event.point, radius: this.props.clickRadius});\n      }\n      if (onHover) {\n        // backward compatibility: v3 `onHover` interface\n        event.features = features;\n        onHover(event);\n      }\n\n      const isHovering = interactiveLayerIds && features && features.length > 0;\n      const isEntering = isHovering && !this.state.isHovering;\n      const isExiting = !isHovering && this.state.isHovering;\n\n      if (isEntering) {\n        this._onEvent('onMouseEnter', event);\n      }\n      if (isExiting) {\n        this._onEvent('onMouseLeave', event);\n      }\n      if (isEntering || isExiting) {\n        this.setState({isHovering});\n      }\n    }\n  }\n\n  _onClick = (event) => {\n    if (this.props.onClick) {\n      event = this._normalizeEvent(event);\n      // backward compatibility: v3 `onClick` interface\n      event.features = this._getFeatures({pos: event.point, radius: this.props.clickRadius});\n      this.props.onClick(event);\n    }\n  }\n\n  render() {\n    const {width, height, style, getCursor} = this.props;\n\n    const eventCanvasStyle = Object.assign({position: 'relative'}, style, {\n      width,\n      height,\n      cursor: getCursor(this.state)\n    });\n    const interactiveContext = {\n      isDragging: this.state.isDragging,\n      eventManager: this._eventManager\n    };\n\n    return createElement(InteractiveContext.Provider, {value: interactiveContext},\n      createElement('div', {\n        key: 'event-canvas',\n        ref: this._eventCanvasRef,\n        style: eventCanvasStyle\n      },\n        createElement(StaticMap, Object.assign({}, this.props,\n          {\n            width: '100%',\n            height: '100%',\n            style: null,\n            onResize: this._onResize,\n            ref: this._staticMapRef,\n            children: this.props.children\n          }\n        ))\n      )\n    );\n  }\n}\n\nInteractiveMap.displayName = 'InteractiveMap';\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\n"],"file":"interactive-map.js"}