{"version":3,"sources":["../../../src/mapbox/mapbox.js"],"names":["PropTypes","document","noop","propTypes","container","object","mapboxApiAccessToken","string","attributionControl","bool","preserveDrawingBuffer","onLoad","func","onError","reuseMaps","reuseMap","transformRequest","mapStyle","visible","width","number","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","mapOptions","defaultProps","body","getAccessToken","preventStyleDiffing","accessToken","window","location","match","search","process","env","MapboxAccessToken","REACT_APP_MAPBOX_ACCESS_TOKEN","checkPropTypes","props","component","debug","Mapbox","constructor","mapboxgl","Error","initialized","console","VERSION","version","_checkStyleSheet","_initialize","finalize","_destroy","setProps","_update","resize","_map","isStyleLoaded","_render","getMap","_create","savedMap","map","oldContainer","getContainer","newContainer","classList","add","childNodes","length","appendChild","_container","setStyle","gl","getContext","HTMLCanvasElement","prototype","center","style","interactive","trackResize","Map","Object","assign","once","on","remove","defineProperty","get","canvas","getCanvas","outline","_updateMapViewport","_updateMapSize","oldProps","newProps","sizeChanged","oldViewState","_getViewState","newViewState","viewportChanged","jumpTo","_getMapboxViewStateProps","transform","mapboxVersion","testElement","createElement","className","display","append","isCssLoaded","getComputedStyle","position","link","setAttribute","head","error"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\n\nfunction noop() {}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object, /** The container to have the map. */\n  mapboxApiAccessToken: PropTypes.string, /** Mapbox API access token for Mapbox tiles/styles. */\n  attributionControl: PropTypes.bool, /** Show attribution control or not. */\n  preserveDrawingBuffer: PropTypes.bool, /** Useful when you want to export the canvas as a PNG. */\n  onLoad: PropTypes.func, /** The onLoad callback for the map */\n  onError: PropTypes.func, /** The onError callback for the map */\n  reuseMaps: PropTypes.bool,\n  reuseMap: PropTypes.bool,\n  transformRequest: PropTypes.func, /** The transformRequest callback for the map */\n\n  mapStyle: PropTypes.string, /** The Mapbox style. A string url to a MapboxGL style */\n  visible: PropTypes.bool, /** Whether the map is visible */\n\n  // Map view state\n  width: PropTypes.number, /** The width of the map. */\n  height: PropTypes.number, /** The height of the map. */\n\n  viewState: PropTypes.object, /** object containing lng/lat/zoom/bearing/pitch */\n\n  longitude: PropTypes.number, /** The longitude of the center of the map. */\n  latitude: PropTypes.number, /** The latitude of the center of the map. */\n  zoom: PropTypes.number, /** The tile zoom level of the map. */\n  bearing: PropTypes.number, /** Specify the bearing of the viewport */\n  pitch: PropTypes.number, /** Specify the pitch of the viewport */\n\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number, /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n  mapOptions: PropTypes.object /** Extra options to pass to Mapbox constructor. See #545. **/\n};\n\nconst defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  preventStyleDiffing: false,\n  onLoad: noop,\n  onError: noop,\n  reuseMaps: false,\n  reuseMap: false,\n  transformRequest: null,\n\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  visible: true,\n\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5,\n\n  width: 0,\n  height: 0,\n\n  mapOptions: {}\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken() {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken = accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  return accessToken || null;\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for mapbox-gl\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure mapbox doesn't crash under Node\n// - Handles map reuse (to work around Mapbox resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Mapbox {\n  constructor(props) {\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    if (!Mapbox.initialized && console.debug) { // eslint-disable-line\n      Mapbox.initialized = true;\n\n      // Version detection using babel plugin\n      /* global __VERSION__ */\n      const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n\n      console.debug(`react-map-gl: ${VERSION} using mapbox-gl v${props.mapboxgl.version}`); // eslint-disable-line\n\n      this._checkStyleSheet(props.mapboxgl.version);\n    }\n\n    this.props = {};\n    this._initialize(props);\n  }\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Mapbox's map.resize() reads size from DOM, so DOM element must already be resized\n  // In a system like React we must wait to read size until after render\n  // (e.g. until \"componentDidUpdate\")\n  resize() {\n    this._map.resize();\n    // map render will throw error if style is not loaded\n    if (this._map.isStyleLoaded()) {\n      this._map._render();\n    }\n    return this;\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n\n  _create(props) {\n    // Reuse a saved map, if available\n    if ((props.reuseMaps || props.reuseMap) && Mapbox.savedMap) {\n      this._map = this.map = Mapbox.savedMap;\n      // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n      // intoto the new container from the props.\n      // Step1: reparenting child nodes from old container to new container\n      const oldContainer = this._map.getContainer();\n      const newContainer = props.container;\n      newContainer.classList.add('mapboxgl-map');\n      while (oldContainer.childNodes.length > 0) {\n        newContainer.appendChild(oldContainer.childNodes[0]);\n      }\n      // Step2: replace the internal container with new container from the react component\n      this._map._container = newContainer;\n      Mapbox.savedMap = null;\n\n      // Update style\n      if (props.mapStyle) {\n        this._map.setStyle(props.mapStyle);\n      }\n\n      // TODO - need to call onload again, need to track with Promise?\n      props.onLoad();\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        style: props.mapStyle,\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = this.map = new props.mapboxgl.Map(\n        Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this.map.once('load', props.onLoad);\n      this.map.on('error', props.onError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (!Mapbox.savedMap) {\n      Mapbox.savedMap = this._map;\n    } else {\n      this._map.remove();\n    }\n    this._map = null;\n  }\n\n  _initialize(props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Mapbox');\n\n    // Make empty string pick up default prop\n    this.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n\n    // Creation only props\n    if (props.mapboxgl) {\n      if (!this.accessToken) {\n        props.mapboxgl.accessToken = 'no-token'; // Prevents mapbox from throwing\n      } else {\n        props.mapboxgl.accessToken = this.accessToken;\n      }\n    }\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    Object.defineProperty(container, 'offsetWidth', {get: () => this.width});\n    Object.defineProperty(container, 'clientWidth', {get: () => this.width});\n    Object.defineProperty(container, 'offsetHeight', {get: () => this.height});\n    Object.defineProperty(container, 'clientHeight', {get: () => this.height});\n\n    // Disable outline style\n    const canvas = this.map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps, newProps) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Mapbox');\n\n    this._updateMapViewport(oldProps, newProps);\n    this._updateMapSize(oldProps, newProps);\n\n    this.props = newProps;\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps, newProps) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this.resize();\n    }\n  }\n\n  _updateMapViewport(oldProps, newProps) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._getMapboxViewStateProps(newProps));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n  }\n\n  _getViewState(props) {\n    const {\n      longitude,\n      latitude,\n      zoom,\n      pitch = 0,\n      bearing = 0,\n      altitude = 1.5\n    } = props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(mapboxVersion = '0.47.0') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check mapbox styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.append(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert mapbox stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute('href',\n          `https://api.tiles.mapbox.com/mapbox-gl-js/v${mapboxVersion}/mapbox-gl.css`);\n        document.head.append(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _getMapboxViewStateProps(props) {\n    const viewState = this._getViewState(props);\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch,\n      width: props.width,\n      height: props.height\n    };\n  }\n}\n\nMapbox.propTypes = propTypes;\nMapbox.defaultProps = defaultProps;\n"],"file":"mapbox.js"}